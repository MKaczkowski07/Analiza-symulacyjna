---
title: "Analiza wpływu wysokości akcyzy na wyroby tytoniowe na wydatki medyczne i pkb"
author: "Filip Kasprzycki i Mateusz Kaczkowski"
date: "2025-11-16"
output:
  ioslides_presentation:
    css: style.css
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

# ---- 1. Wczytanie danych ----
library(readxl)
library(dplyr)
library(ggplot2)
library(GGally)
library(rnaturalearth)
library(rnaturalearthdata)
library(kableExtra)
library(rvest)

# Wczytanie danych
dane1 <- read_excel("Tobacco_consumption_HLTH2022-2.xlsx", sheet = "T1")
OdsetekPalacy <- dane1[, 1:2] %>%
  arrange(.[[1]]) %>%
  rename(Country = 1, Smokers = 2)

dane2 <- read_excel("Europe_Population.xlsx")
PopulacjaKraju <- dane2[, 1:2] %>%
  arrange(.[[1]]) %>%
  rename(Country = 1, Population = 2)

dane3 <- read_excel("europe_gdp_per_capita_2019.xlsx")
PKBKraju <- dane3[, 1:2] %>%
  rename(Country = 1, GDP_per_capita = 2)

dane5 <- read_excel("hlth_sha11_hf$defaultview_spreadsheet.xlsx", sheet="Sheet 1", col_names = FALSE, skip = 18)
WydatkiMedyczne <- dane5[, c(1,10)] %>%
  rename(Country = 1, Wydatki_na_medycyne = 2)

# Pobieranie danych o akcyzie ze strony
url <- "https://taxfoundation.org/data/all/eu/cigarette-tax-europe-2019/"
page <- read_html(url)
dane6 <- page %>% html_table(fill = TRUE)
Akcyza <- dane6[[1]]
Akcyza <- Akcyza[-c(1:3, nrow(Akcyza)), ]
Akcyza <- Akcyza[,c(1:2)]
names(Akcyza) <- c("Country", "Akcyza")
Akcyza$Country <- sub(" .*", "", Akcyza$Country)
Akcyza$Akcyza <- gsub("[^0-9.]", "", Akcyza$Akcyza)
Akcyza$Akcyza <- as.numeric(Akcyza$Akcyza)

# ---- 2. Ujednolicenie krajów i połączenie ----
kraje <- Reduce(intersect, list(OdsetekPalacy$Country, PopulacjaKraju$Country, PKBKraju$Country, Akcyza$Country))

dane_final <- OdsetekPalacy %>%
  filter(Country %in% kraje) %>%
  left_join(PopulacjaKraju, by = "Country") %>%
  left_join(PKBKraju, by = "Country") %>%
  left_join(Akcyza, by = "Country") %>%
  left_join(WydatkiMedyczne, by = "Country")

# Konwersja na typy numeryczne
dane_final$Smokers <- as.numeric(dane_final$Smokers)
dane_final$Population <- as.numeric(dane_final$Population)
dane_final$GDP_per_capita <- as.numeric(dane_final$GDP_per_capita)
dane_final$Wydatki_na_medycyne <- as.numeric(dane_final$Wydatki_na_medycyne)

# Obliczenie korelacji
cor1 <- cor(dane_final$Akcyza, dane_final$GDP_per_capita, use="complete.obs")
cor2 <- cor(dane_final$Akcyza, dane_final$Smokers, use="complete.obs")
```
## Cel analizy
Celem projektu jest analiza zależności między wielkością populacji, PKB, średnimi płacami, wydatkami publicznymi i wpływami z akcyzy

## Żródła danych

Żródła danych:

-Eurostat (w postaci plików xslx)

-Taxfoundation (pobierane bezpośrednio ze strony)


## Zebrane dane

Dane zostały uszeregowane i zebrane do jednej tabeli dane_final
Zawieraja następujące elementy

-Odsetek populacji danego kraju palący papierosy w %

-Liczebność populacji danego kraju

-PKB danego kraju

-Wysokośc akcyzy nakładanej na paczke papierosów

-Wydatki roczne w mln na opiekę medyczną

## Przykładowe dane
```{r wyswietlanie1 , include=TRUE}
# Wyświetlenie przykładowych danych
head(dane_final, 9) %>%
  kable(caption = "Przykładowe dane") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))


```

## Średnie wydatki
```{r wyswietlanie2 , include=TRUE}
summary_stats <- dane_final %>%
  summarise(
    `Liczba krajów` = n(),
    `Średni odsetek palących (%)` = round(mean(Smokers, na.rm = TRUE), 1),
    `Średnie PKB per capita (USD)` = round(mean(GDP_per_capita, na.rm = TRUE), 0),
    `Średnia akcyza (EUR)` = round(mean(Akcyza, na.rm = TRUE), 2),
    `Średnie wydatki medyczne` = round(mean(Wydatki_na_medycyne, na.rm = TRUE), 0)
  )

kable(summary_stats, caption = "Podstawowe statystyki opisowe") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), 
                full_width = FALSE) %>%
  row_spec(0, background = "#3498db", color = "white") %>%
  column_spec(1, bold = TRUE)

```


